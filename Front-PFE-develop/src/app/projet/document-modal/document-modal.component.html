<div class="document-modal-container">
  <!-- Header -->
  <div class="modal-header">
    <h2 mat-dialog-title class="modal-title">
      {{ data.document.fileName || 'Document' }}
    </h2>
    <div class="header-actions">
      <!-- Bouton pour agrandir/r√©duire le PDF -->
      <button *ngIf="isPdf()" mat-icon-button (click)="togglePdfSize()" [class.active]="isLargePdf" matTooltip="Agrandir/R√©duire le PDF">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 9H6v6h3V9zM15 9h-3v6h3V9zM21 3H3v18h18V3zm-2 16H5V5h14v14z"/>
        </svg>
      </button>

      <!-- Info -->
      <button mat-icon-button (click)="toggleDetailsPanel()" [class.active]="showDetails" matTooltip="Afficher/Masquer les d√©tails">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
        </svg>
      </button>

      <!-- Download -->
      <button mat-icon-button (click)="downloadDocument()" matTooltip="T√©l√©charger">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M5 20h14v-2H5v2zM12 3v12l4-4h-3V3h-2v8H8l4 4z"/>
        </svg>
      </button>

      <!-- Close -->
      <button mat-icon-button mat-dialog-close matTooltip="Fermer">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M18.3 5.71L12 12l6.3 6.29-1.42 1.42L12 13.41l-6.29 6.3-1.42-1.42L10.59 12 4.29 5.71 5.71 4.29 12 10.59l6.29-6.3z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Content Area -->
  <div class="modal-content" [class.with-details]="showDetails">
    
    <!-- Document Preview -->
    <div class="document-preview" [class.with-details]="showDetails">
      <div class="preview-container">
        
        <!-- PDF Preview -->
        <div *ngIf="isPdf()" class="pdf-container">
<iframe *ngIf="isPdf() && safePdfUrl"
        [src]="safePdfUrl"
        [class]="isLargePdf ? 'pdf-frame-large' : 'document-frame'"
        type="application/pdf"
        allowfullscreen
        (load)="onDocumentLoaded()"
        (error)="onDocumentError($event)">
</iframe>





        </div>

        <!-- Image Preview -->
        <div *ngIf="isImage()" class="image-container">
          <img [src]="data.url || getImageDataUrl()" 
               [alt]="data.document.fileName"
               class="document-image"
               (load)="onDocumentLoaded()"
               (error)="onImageError($event)">
        </div>

        <!-- Text Preview -->
        <div *ngIf="isText()" class="text-container">
          <pre class="text-content">{{ getTextContent() }}</pre>
        </div>

        <!-- Unsupported Type -->
        <div *ngIf="!isSupportedType()" class="unsupported-container">
          <mat-icon class="unsupported-icon">insert_drive_file</mat-icon>
          <p>Aper√ßu non disponible pour ce type de fichier</p>
          <button mat-raised-button color="primary" (click)="downloadDocument()">
            <mat-icon>download</mat-icon>
            T√©l√©charger le fichier
          </button>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Chargement du document...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error" class="error-container">
          <mat-icon class="error-icon">error</mat-icon>
          <p>{{ error }}</p>
          <button mat-raised-button (click)="retryLoad()">
            <mat-icon>refresh</mat-icon>
            R√©essayer
          </button>
        </div>
      </div>
    </div>

    <!-- Details Panel -->
    <div class="details-panel" [class.show]="showDetails">
      <div class="details-content">
        
        <!-- Document Information -->
               <div class="info-card">
          <div class="info-card-header">
            <h3 class="info-card-title">
              <span class="info-card-icon">üìã</span>
              Informations du document
            </h3>
          </div>
          <div class="info-card-content">
            <div class="info-item">
              <span class="label">Nom</span>
              <span class="value">{{ data.document.fileName || 'N/A' }}</span>
            </div>
            
            <div class="info-item">
              <span class="label">Type</span>
              <span class="value">{{ getFileTypeDisplay() }}</span>
            </div>
            
            <div class="info-item">
              <span class="label">Taille</span>
              <span class="value">{{ getFileSize() }}</span>
            </div>
            
      <div class="info-item" *ngIf="data.document?.createdAt">
  <span class="label">Cr√©√© le</span>

<span class="value">{{ formatDateCustom(data.document.createdAt) }}</span>
</div>



          </div>
        </div>

        <!-- Location Information -->
        <div class="info-card" *ngIf="data.document?.dossier || data.document?.projet">
          <div class="info-card-header">
            <h3 class="info-card-title">
              <span class="info-card-icon">üìç</span>
              Emplacement
            </h3>
          </div>
          <div class="info-card-content">
            <div class="info-item" *ngIf="data.document?.projet">
              <span class="label">Projet</span>
              <span class="value">{{ data.document.projet?.title }}</span>
            </div>
            
            <div class="info-item" *ngIf="data.document?.dossier">
              <span class="label">Dossier</span>
              <span class="value">{{ data.document.dossier.name }}</span>
            </div>

            <!-- Breadcrumb -->
            <div class="breadcrumb" *ngIf="getBreadcrumb().length > 0">
              <div class="breadcrumb-path">
                <span *ngFor="let item of getBreadcrumb(); let last = last" class="breadcrumb-item">
                  {{ item }}
                  <span *ngIf="!last" class="breadcrumb-separator">></span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Document Stats -->
        <div class="info-card" *ngIf="getDocumentStats()">
          <div class="info-card-header">
            <h3 class="info-card-title">
              <span class="info-card-icon">üìä</span>
              Statistiques
            </h3>
          </div>
          <div class="info-card-content">
            <div class="info-item" *ngIf="getPageCount()">
              <span class="label">Pages</span>
              <span class="value">{{ getPageCount() }}</span>
            </div>
            
            <div class="info-item" *ngIf="getWordCount()">
              <span class="label">Mots</span>
              <span class="value">{{ getWordCount() }}</span>
            </div>
          </div>
        </div>

        <!-- Actions -->
       
        <!-- Metadata (if available) -->
        <mat-card class="info-card" *ngIf="hasMetadata()">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>label</mat-icon>
              M√©tadonn√©es
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="metadata-item" *ngFor="let meta of getMetadata()">
              <span class="label">{{ meta.key }} :</span>
              <span class="value">{{ meta.value }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>